<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Structural Equation Modelling (SEM)</title>
    <meta charset="utf-8" />
    <meta name="author" content="Nemanja Vaci" />
    <meta name="date" content="2023-03-23" />
    <script src="Week4_23_files/header-attrs/header-attrs.js"></script>
    <script src="Week4_23_files/kePrint/kePrint.js"></script>
    <link href="Week4_23_files/lightable/lightable.css" rel="stylesheet" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Structural Equation Modelling (SEM)
]
.author[
### Nemanja Vaci
]
.date[
### 2023-03-23
]

---






&lt;style type="text/css"&gt;
body, td {
   font-size: 15px;
}
code.r{
  font-size: 15px;
}
pre {
  font-size: 20px
}
.huge .remark-code { /*Change made here*/
  font-size: 200% !important;
}
.tiny .remark-code { /*Change made here*/
  font-size: 80% !important;
}

---

&lt;/style&gt;

## Press record


---

## Intended learning outcomes

Motivate utilisation of path and CFA models &lt;br/&gt; 
Argue how they connect to other models that we covered at the course. &lt;br/&gt;&lt;br/&gt;

Calculate number of free parameters and degrees of freedom of the proposed model. &lt;br/&gt;&lt;br/&gt;

Build a model in R statistical environment, estimate, and interpret the coefficients. &lt;br/&gt;&lt;br/&gt;

Criticise, modify, compare, and evaluate the fit of the proposed models. 

---

## Structural equation modelling (SEM)

General framework that uses various models to test relationships among variables &lt;br/&gt;

Other terms: covariance structure analysis, covariance structure modelling, __causal modelling__&lt;br/&gt;

Sewell Wright - "mathematical tool for drawing __causal__ conclusions from a combination of of observational data and __theoretical assumptions__" 

Waves:
  1. Latent structures - factor analysis &lt;br/&gt;
  2. Causal modelling through path models &lt;br/&gt;
  3. Structural causal models &lt;br/&gt; &lt;br/&gt;&lt;br/&gt;
  
SEM is a general modelling framework that is composed of measurement model and the structural model. 

???
Judea Pearl - [The Causal Foundations of Structural Equation Modeling](https://ftp.cs.ucla.edu/pub/stat_ser/r370.pdf)

Measurement model focuses on the estimation of latent or composite variables &lt;br/&gt;
Structural model focuses on the estimation of relations between manifest  and/or latent variables in the model (path model) &lt;br/&gt;

Terminology:  &lt;br/&gt;

Manifest variables: observed/collected variables &lt;br/&gt; &lt;br/&gt; 
Latent variables: infered measures - hypothetical constructs  &lt;br/&gt;
 - Indicator variables: measures used to infer the latent concepts
&lt;br/&gt;
&lt;br/&gt; 

Endogenous variables: dependent outcomes &lt;br/&gt; &lt;br/&gt; 
Exogenous variables: predictors &lt;br/&gt; &lt;br/&gt; &lt;br/&gt; 

Focus on covariance structure instead of mean &lt;br/&gt; &lt;br/&gt; 
---

class: inverse, middle, center
# Latent structures
---

## Latent space of measures

--
Principal Component Analysis (PCA) &lt;br/&gt;&lt;br/&gt;
Exploratory Factor Analysis (EFA) &lt;br/&gt;&lt;br/&gt;
Confirmatory Factor Analysis (CFA)

???
Differences between PCA and EFA:&lt;br/&gt;&lt;br/&gt;
[Link 1](https://stats.stackexchange.com/a/95106)&lt;br/&gt;&lt;br/&gt;
[Link 2](https://stats.stackexchange.com/a/288646)
---

## Exploratory factor analysis (EFA)

Multivariate statistical procedure (Spearman): understanding and accounting for variation and covariation among of set of observed variables by postulating __latent__ structures (factors)&lt;br/&gt;&lt;br/&gt;

Factor: unobservable variable that influences more than one observed measure and accounts for their intercorrelation &lt;br/&gt;&lt;br/&gt;

If we partial out latent construct then intercorrelations would be zero &lt;br/&gt;&lt;br/&gt;

Factor analysis decomposes variance: __a) common variance (communality)__ and __b) unique variance__

???
Thourough example of EFA in R: https://psu-psychology.github.io/psy-597-SEM/06_factor_models/factor_models.html#overview
---

## EFA versus CFA

Reproduce observer relationships between measured variables with smaller number of latent factors &lt;br/&gt;&lt;br/&gt;

EFA is data-driven approach: weak or no assumptions on a number of latent dimensions and factor loadings (relations between indicators and factors) &lt;br/&gt; &lt;br/&gt;

CFA is theory-driven approach: strong assumptions for both things &lt;br/&gt;&lt;br/&gt;

EFA is used earlier in the process of questionnaire development and construct validation

---

## Factor model

&lt;img src="image1.png" width="90%" style="display: block; margin: auto;" /&gt;

---

## Factor or measurement model

Is linear regression where the main predictor is latent or unobserved:   &lt;br/&gt;

`$$y=\tau+\lambda*\eta+\epsilon$$`&lt;br/&gt;&lt;br/&gt;
`\(y_1=\tau_1+\lambda_1*\eta+\epsilon_1\)`&lt;br/&gt;
`\(y_2=\tau_2+\lambda_2*\eta+\epsilon_2\)`&lt;br/&gt;
`\(y_3=\tau_3+\lambda_3*\eta+\epsilon_3\)`&lt;br/&gt;&lt;br/&gt;

`\(\tau\)` - the item intercepts or means&lt;br/&gt;
`\(\lambda\)` - factor loadings - regression coefficients  &lt;br/&gt;
`\(\epsilon\)` - error variances and covariances  &lt;br/&gt;
`\(\eta\)` - the latent predictor of the items&lt;br/&gt;
`\(\psi\)` - factor variances and covariances  &lt;br/&gt;
---

## Exploratory factor model

&lt;img src="image2.png" width="90%" style="display: block; margin: auto;" /&gt;

---

## Confirmatory factor model

&lt;img src="image3.png" width="90%" style="display: block; margin: auto;" /&gt;

---

## Defining latent variables

LVs are not measured, however we can still infer them from the observed data. To be able to do so, we need to define their scale:

1. Marker variable: single factor loading constraint to 1 &lt;br/&gt;&lt;br/&gt;
2. Standardized latent variables: setting variance of variable to 1  (Z-score) &lt;br/&gt;&lt;br/&gt; 
3. Effects-coding: constraints that all of the loadings to one LV average 1.0 or that their sum is equal to number of indicators

???
https://www.researchgate.net/publication/255606342_A_Non-arbitrary_Method_of_Identifying_and_Scaling_Latent_Variables_in_SEM_and_MACS_Models
---
## Indicator variable and Standardizing LVs

&lt;img src="IndVar.png" width="70%" style="display: block; margin: auto;" /&gt;

---

## Effect coding 

&lt;img src="Effect.png" width="40%" style="display: block; margin: auto;" /&gt;

---
## First step: Specification of the model





Total number of parameters that we can estimate: `\(\frac{variables*(variables+1)}{2}\)` &lt;br/&gt; &lt;br/&gt; &lt;br/&gt;


```r
Matrix&lt;-cov(vars)
Matrix[upper.tri(Matrix)]&lt;-NA
kableExtra::kable(Matrix, format = 'html', digits = 3, align='l') %&gt;% kableExtra::kable_styling(font_size = 14)
```

&lt;table class="table" style="font-size: 14px; margin-left: auto; margin-right: auto;"&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; TimeOnTummy &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; PreciseLegMoves &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; PreciseHandMoves &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Babbling &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; Screeching &lt;/th&gt;
   &lt;th style="text-align:left;"&gt; VocalImitation &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; TimeOnTummy &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 24.802 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; PreciseLegMoves &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 8.822 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 22.819 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; PreciseHandMoves &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 10.853 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 9.267 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 24.266 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Babbling &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.353 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 4.040 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3.519 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 24.688 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Screeching &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 0.589 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 3.116 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 1.720 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 8.081 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 21.159 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; VocalImitation &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 2.715 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 4.457 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 4.326 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 11.315 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 4.809 &lt;/td&gt;
   &lt;td style="text-align:left;"&gt; 25.012 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
## Theory and previous results

Previous work in this area found that two __congeneric__ latent factors explain covariances of our six indicators: motoric and verbal latent component &lt;br/&gt;&lt;br/&gt;

&lt;img src="image4.png" width="65%" style="display: block; margin: auto;" /&gt;

---
## Estimated number of parameters

&lt;img src="parameters.png" width="50%" style="display: block; margin: auto;" /&gt;
--
Loadings `\((\lambda)\)`: 4 parameters&lt;br/&gt;&lt;br/&gt;
Residual variances `\((\epsilon)\)` : 6 parameters&lt;br/&gt;&lt;br/&gt;
Factor variances and covariances `\((\psi)\)` : 3 parameters&lt;br/&gt;&lt;br/&gt;
With intercepts: + 6 
---
## Second step: model identification

1. Under-indentified: more free parameters than total possible parameters  &lt;br/&gt; &lt;br/&gt;
2. Just-identified: equal number of free parameters and total possible parameters  &lt;br/&gt;&lt;br/&gt;
3. Over-identified: fewer free parameters than total possible parameters  &lt;br/&gt; &lt;br/&gt;
&lt;br/&gt;
Parameters can either be: free, fixed or constrained  &lt;br/&gt;
---
## Third step: estimation of the model


```r
#install.packages('lavaan')
require(lavaan)
model1&lt;-'
motor =~ TimeOnTummy + PreciseLegMoves + PreciseHandMoves
verbal =~ Babbling + Screeching + VocalImitation
'

fit1&lt;-cfa(model1, data=Babies)
```

&lt;style type="text/css"&gt;
pre {
  max-height: 300px;
  overflow-y: auto;
}

pre[class] {
  max-height: 100px;
}
&lt;/style&gt;

&lt;style type="text/css"&gt;
.scroll-100 {
  max-height: 100px;
  overflow-y: auto;
  background-color: inherit;
}
&lt;/style&gt;
---

## Results of the model


```r
summary(fit1)
```

```
## lavaan 0.6-12 ended normally after 74 iterations
## 
##   Estimator                                         ML
##   Optimization method                           NLMINB
##   Number of model parameters                        13
## 
##   Number of observations                           100
## 
## Model Test User Model:
##                                                       
##   Test statistic                                 3.376
##   Degrees of freedom                                 8
##   P-value (Chi-square)                           0.909
## 
## Parameter Estimates:
## 
##   Standard errors                             Standard
##   Information                                 Expected
##   Information saturated (h1) model          Structured
## 
## Latent Variables:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)
##   motor =~                                            
##     TimeOnTummy       1.000                           
##     PreciseLegMovs    0.910    0.240    3.791    0.000
##     PreciseHandMvs    1.099    0.293    3.746    0.000
##   verbal =~                                           
##     Babbling          1.000                           
##     Screeching        0.494    0.182    2.718    0.007
##     VocalImitation    0.716    0.246    2.906    0.004
## 
## Covariances:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)
##   motor ~~                                            
##     verbal            3.433    1.901    1.806    0.071
## 
## Variances:
##                    Estimate  Std.Err  z-value  P(&gt;|z|)
##    .TimeOnTummy      15.031    3.181    4.725    0.000
##    .PreciseLegMovs   14.709    2.867    5.130    0.000
##    .PreciseHandMvs   12.515    3.338    3.749    0.000
##    .Babbling          8.805    5.149    1.710    0.087
##    .Screeching       17.139    2.748    6.236    0.000
##    .VocalImitation   16.742    3.514    4.764    0.000
##     motor             9.523    3.625    2.627    0.009
##     verbal           15.635    5.947    2.629    0.009
```

---

## Results: visual


&lt;img src="image6.png" width="90%" style="display: block; margin: auto;" /&gt;

---

## Interpretation of the coefficients: factor loadings

- When unstandardized and loaded on a single factor, then unstandardized regression coefficients. Model predicted difference in the LVs between groups that differ in 1-unit on the predictor &lt;br/&gt;  &lt;br/&gt;

- When loaded on multiple factors, then regression coefficients become contingent on other factors (check Lecture 1, slide 11)  &lt;br/&gt;  &lt;br/&gt;

- When standardized and loaded on a single factor (congeneric structure), then standardized loadings are estimated correlations between indicators and LVs &lt;br/&gt;  &lt;br/&gt;

- When standardized and loaded on a multiple factors, then same as the second option only standardized (beta weights)  &lt;br/&gt;

---
class: inverse, middle, center
# Causal model
---

## Structural part of the model (path analysis)

Model that test relationship between set of variables, often arranged in some sort of structural form.
&lt;br/&gt;

A common focus of the path model is the estimation of mediation between X and Y.

???
.center[
&lt;img src="graphical.png", width = "120%"&gt; &lt;br/&gt;
]
---
## First step: Specification of the model

.center[
&lt;img src="GeneralExample.png", width = "60%"&gt; &lt;br/&gt;
]
???
Representation of our hypothetical assumptions in the form of the structural equation model
---

## Can model be estimated? 

Total Number of the parameters that we can estimate: `\(\frac{variables*(variables+1)}{2}\)` &lt;br/&gt; &lt;br/&gt; &lt;br/&gt;

.center[
&lt;img src="GeneralExample.png", width = "60%"&gt; &lt;br/&gt;
]

---

## Number of observations




```r
Matrix&lt;-cov(Babies[,c('Nutrition','PhyExer','GMA','SocialBeh','CognitiveAb')])
Matrix[upper.tri(Matrix)]&lt;-NA
knitr::kable(Matrix, format = 'html')
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Nutrition &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; PhyExer &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; GMA &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; SocialBeh &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; CognitiveAb &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Nutrition &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 45.6689837 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; PhyExer &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -10.1006752 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2652.9074 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; GMA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 0.5641485 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -249.3049 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2478.2889 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; SocialBeh &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -11.6168733 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 3417.8681 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; -506.1066 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9988.898 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; CognitiveAb &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 210.6731970 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 48916.6339 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1254.2100 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 94358.621 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1125746 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;

---
## How many parameters are we estimating (path model)?

How many degrees of freedom do we have without the model? 

--
.center[
&lt;img src="ModelParameters.png", width = "60%"&gt; &lt;br/&gt;
]

Number of observations (total number of parameters) = 15&lt;br/&gt;
Empty model = variances and covariances &lt;br/&gt;
Degrees of freedom (df) __= 15 - 8 = 7__ &lt;br/&gt;

???
Most of the time (CFA model or other software):
Degree of freedom for null model = `\((\frac{variables*(variables+1)}{2}) - variables\)`


```r
Matrix&lt;-cov(Babies[,c('Nutrition','PhyExer','GMA','SocialBeh','CognitiveAb')])
Matrix[upper.tri(Matrix)]&lt;-NA
Matrix[lower.tri(Matrix)]&lt;-NA
knitr::kable(Matrix, format = 'html')
```

&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt;   &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; Nutrition &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; PhyExer &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; GMA &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; SocialBeh &lt;/th&gt;
   &lt;th style="text-align:right;"&gt; CognitiveAb &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Nutrition &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 45.66898 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; PhyExer &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2652.907 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; GMA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 2478.289 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; SocialBeh &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 9988.898 &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; CognitiveAb &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; NA &lt;/td&gt;
   &lt;td style="text-align:right;"&gt; 1125746 &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
---
## How many parameters (our model)?

.center[
&lt;img src="ModelParameters.png", width = "60%"&gt; &lt;br/&gt;
]

Free parameters = variances + covariances + regression pathways = 14
---

## Second step: model identification

1. Under-indentified: more free parameters than total possible parameters  &lt;br/&gt; &lt;br/&gt;
2. Just-identified: equal number of free parameters and total possible parameters  &lt;br/&gt;&lt;br/&gt;
3. Over-identified: fewer free parameters than total possible parameters  &lt;br/&gt; &lt;br/&gt;
&lt;br/&gt;
Parameters can either be: free, fixed or constrained  &lt;br/&gt;

---

## Third step: estimation of the model

&lt;style type="text/css"&gt;
pre {
  max-height: 300px;
  overflow-y: auto;
}

pre[class] {
  max-height: 100px;
}
&lt;/style&gt;

&lt;style type="text/css"&gt;
.scroll-100 {
  max-height: 100px;
  overflow-y: auto;
  background-color: inherit;
}
&lt;/style&gt;


```r
modelAbility&lt;-'
SocialBeh~Nutrition+PhyExer+GMA
CognitiveAb~SocialBeh+Nutrition+GMA
'
```
--

```r
fit1&lt;-sem(modelAbility, data=Babies)
summary(fit1)
```

```
## lavaan 0.6-12 ended normally after 1 iterations
## 
##   Estimator                                         ML
##   Optimization method                           NLMINB
##   Number of model parameters                         8
## 
##   Number of observations                           100
## 
## Model Test User Model:
##                                                       
##   Test statistic                               215.236
##   Degrees of freedom                                 1
##   P-value (Chi-square)                           0.000
## 
## Parameter Estimates:
## 
##   Standard errors                             Standard
##   Information                                 Expected
##   Information saturated (h1) model          Structured
## 
## Regressions:
##                    Estimate    Std.Err   z-value  P(&gt;|z|)
##   SocialBeh ~                                            
##     Nutrition           0.030     1.105    0.027    0.978
##     PhyExer             1.281     0.146    8.796    0.000
##     GMA                -0.075     0.151   -0.500    0.617
##   CognitiveAb ~                                          
##     SocialBeh           9.579     0.469   20.428    0.000
##     Nutrition           7.019     6.899    1.017    0.309
##     GMA                 2.461     0.941    2.614    0.009
## 
## Variances:
##                    Estimate    Std.Err   z-value  P(&gt;|z|)
##    .SocialBeh        5515.809   780.053    7.071    0.000
##    .CognitiveAb    215129.001 30423.835    7.071    0.000
```
---
## Direct and indirect

.center[
&lt;img src="simplified.png", width = "60%"&gt; 
]

Direct effect (c): subgroups/cases that differ by one unit on X, but are equal on M are estimated to differ by __c__ units on Y. &lt;br/&gt;

Indirect effect: &lt;br/&gt;
  a) X -&gt; M: cases that differ by one unit in X are estimated to differ by __a__ units on M &lt;br/&gt;
  b) M -&gt; Y: cases that differ by one unit in M, but are equal on X, are estimated to differ by __b__ units on Y &lt;br/&gt;&lt;br/&gt;
The indirect effect of X on Y through M is a product of __a__ and __b__. The two cases that differ by one unit on X are estimated to differ by __ab__ units on Y as a result of the effect of X on M which affects Y. 

---
## Direct and indirect


```r
modelAbilityPath&lt;-'
SocialBeh~Nutrition+a*PhyExer+GMA
CognitiveAb~b*SocialBeh+c*Nutrition+GMA

indirect := a*b
direct := c
total := indirect + direct
'
fitPath&lt;-sem(modelAbilityPath, data=Babies)
summary(fitPath)
```

```
## lavaan 0.6-12 ended normally after 1 iterations
## 
##   Estimator                                         ML
##   Optimization method                           NLMINB
##   Number of model parameters                         8
## 
##   Number of observations                           100
## 
## Model Test User Model:
##                                                       
##   Test statistic                               215.236
##   Degrees of freedom                                 1
##   P-value (Chi-square)                           0.000
## 
## Parameter Estimates:
## 
##   Standard errors                             Standard
##   Information                                 Expected
##   Information saturated (h1) model          Structured
## 
## Regressions:
##                    Estimate    Std.Err   z-value  P(&gt;|z|)
##   SocialBeh ~                                            
##     Nutrition           0.030     1.105    0.027    0.978
##     PhyExer    (a)      1.281     0.146    8.796    0.000
##     GMA                -0.075     0.151   -0.500    0.617
##   CognitiveAb ~                                          
##     SocialBeh  (b)      9.579     0.469   20.428    0.000
##     Nutrition  (c)      7.019     6.899    1.017    0.309
##     GMA                 2.461     0.941    2.614    0.009
## 
## Variances:
##                    Estimate    Std.Err   z-value  P(&gt;|z|)
##    .SocialBeh        5515.809   780.053    7.071    0.000
##    .CognitiveAb    215129.001 30423.835    7.071    0.000
## 
## Defined Parameters:
##                    Estimate    Std.Err   z-value  P(&gt;|z|)
##     indirect           12.275     1.519    8.079    0.000
##     direct              7.019     6.899    1.017    0.309
##     total              19.294     7.074    2.727    0.006
```
???
Interaction between the predictors can be included similar to the linear regression model by using (:) sign.&lt;br/&gt; &lt;br/&gt;

modelAbilityInteraction&lt;-&lt;br/&gt;
SocialBeh~Nutrition+PhyExer+GMA+__PhyExer:GMA__&lt;br/&gt;
CognitiveAb~SocialBeh+Nutrition+GMA&lt;br/&gt;

---

## Step four: model evaluation

Chi-square test: measure of how well model-implied covariance matrix fits data covariance &lt;br/&gt; &lt;br/&gt;

We would prefer not to reject the null hypothesis in this case &lt;br/&gt;

Assumptions: &lt;br/&gt;
Multivariate normality &lt;br/&gt;
N is sufficiently large (150+)&lt;br/&gt;
Parameters are not at boundary or invalid (e.g. variance of zero)&lt;br/&gt;&lt;br/&gt;&lt;br/&gt;

With the large samples it is sensitive to small misfits &lt;br/&gt;
Nonormality induces bias &lt;br/&gt; 
---

## Other fit indices

```r
summary(fit1, fit.measures=TRUE)
```

```
## lavaan 0.6-12 ended normally after 1 iterations
## 
##   Estimator                                         ML
##   Optimization method                           NLMINB
##   Number of model parameters                         8
## 
##   Number of observations                           100
## 
## Model Test User Model:
##                                                       
##   Test statistic                               215.236
##   Degrees of freedom                                 1
##   P-value (Chi-square)                           0.000
## 
## Model Test Baseline Model:
## 
##   Test statistic                               438.108
##   Degrees of freedom                                 7
##   P-value                                        0.000
## 
## User Model versus Baseline Model:
## 
##   Comparative Fit Index (CFI)                    0.503
##   Tucker-Lewis Index (TLI)                      -2.479
## 
## Loglikelihood and Information Criteria:
## 
##   Loglikelihood user model (H0)              -1328.506
##   Loglikelihood unrestricted model (H1)      -1220.888
##                                                       
##   Akaike (AIC)                                2673.012
##   Bayesian (BIC)                              2693.853
##   Sample-size adjusted Bayesian (BIC)         2668.587
## 
## Root Mean Square Error of Approximation:
## 
##   RMSEA                                          1.464
##   90 Percent confidence interval - lower         1.303
##   90 Percent confidence interval - upper         1.632
##   P-value RMSEA &lt;= 0.05                          0.000
## 
## Standardized Root Mean Square Residual:
## 
##   SRMR                                           0.080
## 
## Parameter Estimates:
## 
##   Standard errors                             Standard
##   Information                                 Expected
##   Information saturated (h1) model          Structured
## 
## Regressions:
##                    Estimate    Std.Err   z-value  P(&gt;|z|)
##   SocialBeh ~                                            
##     Nutrition           0.030     1.105    0.027    0.978
##     PhyExer             1.281     0.146    8.796    0.000
##     GMA                -0.075     0.151   -0.500    0.617
##   CognitiveAb ~                                          
##     SocialBeh           9.579     0.469   20.428    0.000
##     Nutrition           7.019     6.899    1.017    0.309
##     GMA                 2.461     0.941    2.614    0.009
## 
## Variances:
##                    Estimate    Std.Err   z-value  P(&gt;|z|)
##    .SocialBeh        5515.809   780.053    7.071    0.000
##    .CognitiveAb    215129.001 30423.835    7.071    0.000
```

---

## Other fit indices
.center[
&lt;img src="fitInd.png", width = "60%"&gt;
]

???
TLI: fit of .95 indicates that the fitted model improves the fit by 95% relative to the null mode, works OK with smaller sample sizes &lt;br/&gt; &lt;br/&gt;
CFI: Same as TLI, but not very sensitive to sample size &lt;br/&gt; &lt;br/&gt;
RMSEA: difference between the residuals of the sample covariance matrix and hypothesized model. If we have different scales it is hard to interpret, then we can check standardised root mean square residual (SRMR)&lt;br/&gt;&lt;br/&gt;
---
class: inverse, middle, center
# Structural Equation Model
---
## SEM, finally

&lt;img src="SEM.png" width="80%" style="display: block; margin: auto;" /&gt;
---

## Estimation of SEM






```r
model4&lt;-'
#CFA model
motor =~ TimeOnTummy + PreciseLegMoves + PreciseHandMoves
verbal =~ Babbling + Screeching + VocalImitation

#Path model
motor ~ Age + Weight
verbal ~ Age + Weight
'

fit4&lt;-sem(model4, data=Babies)
```

---
## Structural equation model: Results


```r
summary(fit4, standardized=TRUE)
```

```
## lavaan 0.6-12 ended normally after 81 iterations
## 
##   Estimator                                         ML
##   Optimization method                           NLMINB
##   Number of model parameters                        17
## 
##   Number of observations                           100
## 
## Model Test User Model:
##                                                       
##   Test statistic                                13.018
##   Degrees of freedom                                16
##   P-value (Chi-square)                           0.671
## 
## Parameter Estimates:
## 
##   Standard errors                             Standard
##   Information                                 Expected
##   Information saturated (h1) model          Structured
## 
## Latent Variables:
##                    Estimate    Std.Err  z-value  P(&gt;|z|)   Std.lv    Std.all
##   motor =~                                                                  
##     TimeOnTummy         1.000                                 3.064    0.618
##     PreciseLegMovs      0.919    0.242    3.803    0.000      2.816    0.592
##     PreciseHandMvs      1.111    0.295    3.765    0.000      3.403    0.694
##   verbal =~                                                                 
##     Babbling            1.000                                 3.498    0.708
##     Screeching          0.583    0.189    3.089    0.002      2.040    0.446
##     VocalImitation      0.899    0.263    3.422    0.001      3.144    0.632
## 
## Regressions:
##                    Estimate    Std.Err  z-value  P(&gt;|z|)   Std.lv    Std.all
##   motor ~                                                                   
##     Age                -0.016    0.045   -0.355    0.723     -0.005   -0.043
##     Weight              0.000    0.001    0.085    0.932      0.000    0.010
##   verbal ~                                                                  
##     Age                -0.041    0.051   -0.803    0.422     -0.012   -0.097
##     Weight              0.002    0.001    2.108    0.035      0.001    0.263
## 
## Covariances:
##                    Estimate    Std.Err  z-value  P(&gt;|z|)   Std.lv    Std.all
##  .motor ~~                                                                  
##    .verbal              3.292    1.738    1.894    0.058      0.320    0.320
## 
## Variances:
##                    Estimate    Std.Err  z-value  P(&gt;|z|)   Std.lv    Std.all
##    .TimeOnTummy        15.164    3.159    4.800    0.000     15.164    0.618
##    .PreciseLegMovs     14.662    2.862    5.122    0.000     14.662    0.649
##    .PreciseHandMvs     12.440    3.327    3.740    0.000     12.440    0.518
##    .Babbling           12.204    3.740    3.263    0.001     12.204    0.499
##    .Screeching         16.784    2.717    6.177    0.000     16.784    0.801
##    .VocalImitation     14.880    3.440    4.326    0.000     14.880    0.601
##    .motor               9.372    3.577    2.620    0.009      0.998    0.998
##    .verbal             11.299    4.205    2.687    0.007      0.923    0.923
```

---

## Prerequisites

Theory: Strong theoretical assumptions that could be used to draw causal assumptions that could be tested using the data and specification of the model &lt;br/&gt;&lt;br/&gt;

Data: large samples &lt;br/&gt;
 - We are not that interested in significance: &lt;br/&gt;&lt;br/&gt;
  a) Overall behaviour of the model more interesting&lt;br/&gt;&lt;br/&gt;
  b) More data higher probability of significant results (weak effects)&lt;br/&gt;&lt;br/&gt;
  c) Latent models are estimated by anchoring on indicator variables, different estimation can result in different patterns&lt;br/&gt;&lt;br/&gt;

---
## Problems with SEM and alternatives

1. Variables derived from the normal distribution &lt;br/&gt;
2. Observations independent &lt;br/&gt;
3. Large sample size &lt;br/&gt;

---
## Important aspects: theory 

- Understanding differences between Exploratory FA and Confirmatory FA &lt;br/&gt;
- How is linear model defined in the CFA&lt;br/&gt;
- Scaling of the latent variables &lt;br/&gt;
- Interpretation of the coefficients &lt;br/&gt;
- Number of free parameters versus total number of parameters &lt;br/&gt;
- Overall fit of the model 

---

## Important aspects: practice

- Specifying and estimating CFA model and path model &lt;br/&gt;
- Scaling the LVs by using marker variable &lt;br/&gt;
- Calculation of the direct and indirect pathways for predictors of interest &lt;br/&gt;
- Making a full SEM model &lt;br/&gt;

---

## Literature

Confirmatory Factor Analysis for Applied Research by Timothy A. Brown  &lt;br/&gt; &lt;br/&gt;

Chapters 9 of Principles and Practice of Structural Equation Modeling by Rex B. Kline &lt;br/&gt;&lt;br/&gt; 


Latent Variable Modeling Using R: A Step-by-Step Guide by A. Alexander Beaujean &lt;br/&gt;&lt;br/&gt;

---

## Thank you for your attention
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"slideNumberFormat": "%current%",
"highlightStyle": "github",
"highlightLines": true,
"ratio": "16:9",
"countIncrementalSlides": true
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
